---
- name: Install api.opencivicdata.org
  hosts: influenceexplorer_api
  user: ubuntu
  sudo: yes
  roles:
    - role: common-roles/common
      hostname: api.influenceexplorer.com
      extra_packages:
        - libpq-dev
        - unzip
        - gdal-bin
    - role: common-roles/ebs
      device_letter: l
      volume_size: 10
      ebs_path: /projects/api.opencivicdata.org/
    - role: common-roles/django
      project_name: api.opencivicdata.org
      git_repositories:
          - repo: "git://github.com/influence-usa/api.opencivicdata.org.git"
            dir: api.opencivicdata.org
            version: disclosures
          - repo: "git://github.com/influence-usa/imago.git"
            dir: imago
            version: disclosures
      wsgi_module: ocdapi.wsgi:application
    - role: common-roles/https
      when: deploy_type != "vagrant"
    - role: api
      project_name: api.opencivicdata.org
